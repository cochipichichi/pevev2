<!DOCTYPE html>
<html lang="es"><head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Profesor â€” ğŸ“šPEVE</title>
<link href="../assets/style.css" rel="stylesheet"/>
<meta content="#0b0f14" name="theme-color"/>
<script defer="" src="../assets/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Panel docente en modo DEMO (sin conexiÃ³n real a Google Sheets / Apps Script).
    function $(sel){ return document.querySelector(sel); }

    let chartCourse, chartStudent;

    function renderCourseChart(rows){
      if (!window.Chart) {
        alert('Vista demo: falta Chart.js para dibujar el grÃ¡fico.');
        return;
      }
      const canvas = document.getElementById('chart-course');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const labels = rows.map(r => r.oa);
      const dataAvg = rows.map(r => Number(r.promedio));
      const dataAtt = rows.map(r => Number(r.intentos));
      if (chartCourse) chartCourse.destroy();
      chartCourse = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            { label: 'Promedio', data: dataAvg },
            { label: 'Intentos', data: dataAtt }
          ]
        },
        options: { responsive:true, maintainAspectRatio:false }
      });
    }

    function renderStudentChart(rows){
      if (!window.Chart) {
        alert('Vista demo: falta Chart.js para dibujar el grÃ¡fico.');
        return;
      }
      const canvas = document.getElementById('chart-student');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const labels = rows.map(r => r.courseId + '-' + r.oa);
      const dataAvg = rows.map(r => Number(r.promedio));
      if (chartStudent) chartStudent.destroy();
      chartStudent = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: 'Promedio', data: dataAvg }
          ]
        },
        options: { responsive:true, maintainAspectRatio:false }
      });
    }

    async function loadStatsCourse(){
      // Datos de ejemplo solamente
      const idInput = document.getElementById('st_course');
      const id = idInput ? idInput.value.trim() : '';
      if (!id) {
        alert('Ingresa courseId (ej: BIO1M) para la simulaciÃ³n.');
        return;
      }
      const rows = [
        { oa:'OA2', intentos: 12, promedio: 85 },
        { oa:'OA4', intentos: 9,  promedio: 78 },
        { oa:'OA6', intentos: 7,  promedio: 91 },
        { oa:'OA8', intentos: 5,  promedio: 80 }
      ];
      const tb = document.querySelector('#stats-course tbody');
      if (tb) {
        tb.innerHTML = '';
        rows.forEach(x => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${x.oa}</td><td>${x.intentos}</td><td>${x.promedio}</td>`;
          tb.appendChild(tr);
        });
      }
      renderCourseChart(rows);
      alert('Vista demo: estos datos son simulados. Para conectar datos reales, usa Apps Script (PEVE_ADMIN.peveStatsByCourse).');
    }

    async function loadStatsStudent(){
      const idInput = document.getElementById('st_user');
      const id = idInput ? idInput.value.trim() : '';
      if (!id) {
        alert('Ingresa userId (ej: est1) para la simulaciÃ³n.');
        return;
      }
      const rows = [
        { courseId:'BIO1M', oa:'OA2', intentos:4, promedio:88 },
        { courseId:'BIO1M', oa:'OA4', intentos:3, promedio:75 },
        { courseId:'BIO1M', oa:'OA6', intentos:2, promedio:92 }
      ];
      const tb = document.querySelector('#stats-student tbody');
      if (tb) {
        tb.innerHTML = '';
        rows.forEach(x => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${x.courseId}</td><td>${x.oa}</td><td>${x.intentos}</td><td>${x.promedio}</td>`;
          tb.appendChild(tr);
        });
      }
      renderStudentChart(rows);
      alert('Vista demo: estos datos son simulados. Para conectar datos reales, usa Apps Script (PEVE_ADMIN.peveStatsByStudent).');
    }

    async function exportPDF(){
      alert('Vista demo: la exportaciÃ³n a PDF se habilita cuando conectes Apps Script (peveExportPDF).');
    }

    async function uploadEvidence(){
      alert('Vista demo: la subida de evidencias se habilita cuando conectes Apps Script / Google Drive (peveUploadEvidence).');
    }

    window.addEventListener('DOMContentLoaded', async () => {
      try {
        if (typeof getSession === 'function') {
          const u = getSession();
          if (!u || u.role !== 'teacher') {
            // En modo demo puedes comentar la siguiente lÃ­nea para no forzar login.
            // location.href = 'login.html';
          } else {
            const who = document.getElementById('who');
            if (who) who.textContent = u.name || u.id || 'Docente';
          }
        }
      } catch (e) {}

      try {
        const res = await fetch('../data/courses.json');
        const data = await res.json();
        const course = data["BiologÃ­a 1M"];
        const oaList = document.getElementById('oa');
        if (course && oaList) {
          course.oas.forEach(oa => {
            const li = document.createElement('li');
            li.textContent = oa.code + ' â€” ' + oa.name;
            oaList.appendChild(li);
          });
        }
      } catch (e) {
        console.warn('No se pudo cargar BiologÃ­a 1M para el panel docente (demo).', e);
      }
    });
  </script>
<link href="../assets/css/theme.css" rel="stylesheet"/></head>
<body data-home="../index.html">
<header class="header">
<div class="logo">
<span class="badge" data-i18n="c.peve_63155b10">ğŸ“šPEVE</span>
<span class="title" data-i18n="c.plataforma_exÃ¡menes_de_validaciÃ³n_de_est_a925d25a">Plataforma ExÃ¡menes de ValidaciÃ³n de Estudios</span>
</div>
<div class="row">
<button class="toggle" data-action="fs-dec">Aâˆ’</button>
<button class="toggle" data-action="fs-inc">A+</button>
<button class="toggle" data-action="contrast" data-i18n="c.alto_contraste_32387669">ğŸŒ“ Alto contraste</button>
</div>
<div aria-label="Controles de accesibilidad" class="accessibility-toolbar" data-i18n-aria-label="c.attr.aria-label.controles_de_accesibilidad_e1513252">
<button class="access-btn" data-action="home" data-home="../index.html" data-i18n-title="c.attr.title.ir_al_inicio_115d499a" title="Ir al inicio">ğŸ </button>
<button class="access-btn" data-action="narrator" data-i18n-title="c.attr.title.leer_el_contenido_de_la_pÃ¡gina_b153cdac" title="Leer el contenido de la pÃ¡gina">ğŸ—£ï¸</button>
<button class="access-btn" data-action="toggle-theme" data-i18n-title="c.attr.title.cambiar_tema_clarooscuro_c39e5dae" title="Cambiar tema claro/oscuro">ğŸŒ“</button>
<button class="access-btn" data-action="font-inc" data-i18n-title="c.attr.title.aumentar_tamaÃ±o_de_letra_e7bb9209" title="Aumentar tamaÃ±o de letra">A+</button>
<button class="access-btn" data-action="font-dec" data-i18n-title="c.attr.title.disminuir_tamaÃ±o_de_letra_75a8c21b" title="Disminuir tamaÃ±o de letra">Aâˆ’</button>
<button class="access-btn" data-action="lang" data-i18n-title="c.attr.title.cambiar_idioma_esenfr_9e345c96" title="Cambiar idioma ES/EN/FR">ğŸŒ</button>
<button class="access-btn" data-action="guide" data-i18n-title="c.attr.title.mostrar_guÃ­a_paso_a_paso_c06bf245" title="Mostrar guÃ­a paso a paso">ğŸ§ </button>
<button class="access-btn" data-action="search" data-i18n-title="c.attr.title.buscar_en_esta_pÃ¡gina_90fa8efb" title="Buscar en esta pÃ¡gina">ğŸ”</button>
</div>
</header>
<main>
<div class="row" style="justify-content:space-between;align-items:center">
<h2>ğŸ‘©â€ğŸ« Panel Docente â€” <span id="who"></span></h2>
<button class="toggle" data-action="logout" data-i18n="c.cerrar_sesiÃ³n_f394d025">Cerrar sesiÃ³n</button>
</div>
<div class="grid">
<div class="card">
<h3 data-i18n="p.app__teacher.0001">OA BiologÃ­a 1M</h3>
<ul id="oa"></ul>
<div class="row">
<a class="btn" data-i18n="p.app__teacher.0002" href="../pages/quiz_bio1m.html">ğŸ§ª Gestionar Quiz</a>
<a class="btn" data-i18n="c.ticket_de_salida_5dcd1a80" href="../pages/ticket_bio1m.html">ğŸŸï¸ Ticket de salida</a>
<a class="btn purple" data-i18n="p.app__teacher.0003" href="https://cochipichichi.github.io/OA2_Evidencias_Evolucion_BIO1M_docente/index.html" rel="noopener" target="_blank">ğŸ“š Zona Docente OA2</a>
</div>
</div>
<div class="card">
<h3 data-i18n="p.app__teacher.0004">Dashboard (demo)</h3>
<p data-i18n="p.app__teacher.0005">Vista rÃ¡pida de avance (simulada):</p>
<table class="table">
<tr><th data-i18n="c.estudiante_7a3b082a">Estudiante</th><th data-i18n="p.app__teacher.0006">Quiz OA2</th><th data-i18n="p.app__teacher.0007">Quiz OA4</th><th data-i18n="p.app__teacher.0008">Quiz OA6</th><th data-i18n="p.app__teacher.0009">Quiz OA8</th></tr>
<tr><td data-i18n="p.app__teacher.0010">Estudiante Demo</td><td data-i18n="p.app__teacher.0011">85%</td><td data-i18n="p.app__teacher.0012">70%</td><td data-i18n="p.app__teacher.0013">90%</td><td data-i18n="p.app__teacher.0014">80%</td></tr>
</table>
<small data-i18n="p.app__teacher.0015">Conectar a Google Sheets o una API para datos reales.</small>
</div>
</div>
<div class="grid">
<div class="card">
<h3 data-i18n="p.app__teacher.0016">ğŸ“Š EstadÃ­sticas por curso (Sheets)</h3>
<div class="row">
<input data-i18n-placeholder="p.app__teacher.0022" id="st_course" placeholder="courseId (ej: BIO1M)"/>
<button class="btn" data-i18n="c.cargar_e97b1cb6" onclick="loadStatsCourse()">Cargar</button>
<button class="btn" data-i18n="p.app__teacher.0017" onclick="exportPDF()">Exportar PDF</button>
</div>
<table class="table" id="stats-course"><thead><tr><th data-i18n="c.oa_cabcf0a5">OA</th><th data-i18n="c.intentos_a3a1c519">Intentos</th><th data-i18n="c.promedio_f491932f">Promedio</th></tr></thead><tbody></tbody></table>
<canvas id="chart-course" style="max-height:320px"></canvas>
</div>
<div class="card">
<h3 data-i18n="p.app__teacher.0018">ğŸ‘¤ EstadÃ­sticas por estudiante</h3>
<div class="row">
<input data-i18n-placeholder="p.app__teacher.0023" id="st_user" placeholder="userId (ej: est1)"/>
<button class="btn" data-i18n="c.cargar_e97b1cb6" onclick="loadStatsStudent()">Cargar</button>
</div>
<table class="table" id="stats-student"><thead><tr><th data-i18n="c.curso_32c85c59">Curso</th><th data-i18n="c.oa_cabcf0a5">OA</th><th data-i18n="c.intentos_a3a1c519">Intentos</th><th data-i18n="c.promedio_f491932f">Promedio</th></tr></thead><tbody></tbody></table>
<canvas id="chart-student" style="max-height:320px"></canvas>
</div>
<div class="card">
<h3 data-i18n="p.app__teacher.0019">ğŸ“ Adjuntar evidencia (Drive)</h3>
<p data-i18n="p.app__teacher.0020">Sube un archivo (PDF/imagen) como evidencia vinculada a un OA.</p>
<div class="row">
<input data-i18n-placeholder="p.app__teacher.0024" id="ev_user" placeholder="userId"/>
<input data-i18n-placeholder="p.app__teacher.0025" id="ev_course" placeholder="courseId"/>
<input data-i18n-placeholder="p.app__teacher.0026" id="ev_oa" placeholder="OA (ej: OA2)"/>
</div>
<input accept="image/*,application/pdf" id="ev_file" type="file"/>
<div class="row"><button class="btn green" data-i18n="p.app__teacher.0021" onclick="uploadEvidence()">Subir</button></div>
<p class="notice" id="ev_out">â€”</p>
</div>
</div>
<!-- Bloque de accesibilidad comÃºn PEVE -->
<section class="section">
<article aria-label="InformaciÃ³n de accesibilidad de la plataforma PEVE" class="card accessibility-card" data-i18n-aria-label="c.attr.aria-label.informaciÃ³n_de_accesibilidad_de_la_plata_fca079ae">
<h2 data-i18n="c.accesibilidad_fd501df9">ğŸ§© Accesibilidad</h2>
<p class="note" data-i18n="c.controles__inicio___lee_todo_el_contenid_573aa174">
      ğŸ› ï¸ Controles: ğŸ  inicio Â· ğŸ—£ï¸ lee todo el contenido de la pÃ¡gina Â· ğŸŒ“ alto contraste Â· A+ / Aâˆ’ tamaÃ±o de letra Â·
      ğŸŒ ES / EN / FR (traducciÃ³n del sitio) Â· ğŸ§  guÃ­a paso a paso Â· ğŸ” lupa.
    </p>
</article>
</section>
</main>
<footer class="footer small">
<div class="footer-inner">
<!-- <div class="footer-logo"> -->
<div class="footer-bar">
<div class="logo"><img alt="Neotech EduLab" class="logo-img" data-i18n-alt="c.attr.alt.neotech_edulab_ef78e95d" onerror="this.style.display='none'" src="../assets/logo.svg"/>
<div><strong>Â© <strong data-i18n="c.neotech_edulab_985e1a35">Neotech EduLab</strong>-EducaciÃ³n Inmersiva</strong></div>
<small data-i18n="c.prohibida_su_copia_yo_reproducciÃ³n_d83cfd46">ğŸ› ï¸Prohibida su copia y/o reproducciÃ³n</small>
</div>
</div>
<div class="footer-text">
<!-- <img src="../assets/img/logo-peve.svg" alt="Logo PEVE" class="logo-img" onerror="this.style.display='none'">
        <p><strong>Neotech EduLab Â· EducaciÃ³n Inmersiva</strong></p> -->
<p>Â© 2025 <strong data-i18n="c.peve_63155b10">ğŸ“šPEVE</strong> â€“ Plataforma de ExÃ¡menes de ValidaciÃ³n de Estudios Â· Hecho con â¤ï¸ y enfoque inclusivo.</p>
<p class="footer-note" data-i18n="c.peve_es_un_recurso_pedagÃ³gico_complement_a28eeb20">
          PEVE es un recurso pedagÃ³gico complementario. La inscripciÃ³n, rendiciÃ³n y certificaciÃ³n de ExÃ¡menes Libres
          depende exclusivamente del Ministerio de EducaciÃ³n de Chile y sus canales oficiales.
        </p>
</div>
</div>
</footer>

<script defer="" src="../assets/js/main.js"></script>
<script src="../assets/js/accessibility.js"></script></body></html>
