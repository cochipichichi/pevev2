<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“Š Informes Apoderado/a â€“ ğŸ“šPEVE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../../assets/css/style.css" />
</head>
<body class="theme-dark">
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle">ğŸ“š</div>
      <div class="brand-text">
        <span class="brand-name">PEVE</span>
        <span class="brand-subtitle">Informes para apoderado/a</span>
      </div>
    </div>
    <nav class="topbar-nav" aria-label="NavegaciÃ³n principal">
      <a href="../../index.html" class="nav-link" data-i18n="nav.inicio">Inicio</a>
      <a href="../dashboard_apoderado.html" class="nav-link">Panel Apoderado/a</a>
      <a href="../../pages/niveles.html" class="nav-link" data-i18n="nav.niveles">Niveles</a>
      <a href="../../pages/asignaturas.html" class="nav-link" data-i18n="nav.asignaturas">Asignaturas</a>
      <a href="../../pages/perfiles.html" class="nav-link" data-i18n="nav.perfiles">Perfiles</a>
      <a href="../../pages/accesibilidad.html" class="nav-link" data-i18n="nav.accesibilidad">Accesibilidad</a>
      <a href="../../pages/acerca.html" class="nav-link" data-i18n="nav.acerca">Acerca de</a>
    </nav>

    <div class="accessibility-toolbar" aria-label="Controles de accesibilidad">
      <button class="access-btn" data-action="home" data-home="../../index.html" title="Ir al inicio">ğŸ </button>
      <button class="access-btn" data-action="narrator" title="Leer el contenido de la pÃ¡gina">ğŸ—£ï¸</button>
      <button class="access-btn" data-action="toggle-theme" title="Cambiar tema claro/oscuro">ğŸŒ“</button>
      <button class="access-btn" data-action="font-inc" title="Aumentar tamaÃ±o de letra">A+</button>
      <button class="access-btn" data-action="font-dec" title="Disminuir tamaÃ±o de letra">Aâˆ’</button>
      <button class="access-btn" data-action="lang" title="Cambiar idioma ES/EN/FR">ğŸŒ</button>
      <button class="access-btn" data-action="guide" title="Abrir guÃ­a paso a paso">ğŸ§ </button>
      <button class="access-btn" data-action="search" title="Buscar en esta pÃ¡gina">ğŸ”</button>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>ğŸ“Š Informe de avance (Apoderado/a)</h1>
      <p class="note">
        MÃ³dulo pensado para que <strong id="guardian-name-inline">el/la apoderado/a</strong> revise un resumen del avance de
        <strong id="guardian-student-name-inline">su estudiante</strong> y pueda exportarlo a PDF.
      </p>
      <p class="note">
        Estudiante: <strong id="guardian-student-name-hero">â€”</strong> Â· Nivel:
        <strong id="guardian-student-level-hero">â€”</strong> Â· Llamado:
        <strong id="guardian-student-call-hero">â€”</strong>
      </p>

      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1rem;">
        <div class="card">
          <h3>ğŸ‘¤ Estudiante</h3>
          <label class="small" for="g-run">RUN del estudiante</label>
          <input id="g-run" class="input" placeholder="Ej: 12.345.678-9" />
          <label class="small" for="g-idpeve" style="margin-top:.5rem;">ID PEVE (opcional)</label>
          <input id="g-idpeve" class="input" placeholder="Ej: STU-2025-0001" />
          <button class="btn btn-solid" id="g-load" style="margin-top:.75rem;width:100%;">ğŸ”„ Cargar informe</button>
          <p class="small note" id="g-status" style="margin-top:.6rem;">Listo.</p>
        </div>

        <div class="card">
          <h3>ğŸ“Œ Resumen</h3>
          <div class="small">Ãšltima actualizaciÃ³n</div>
          <div id="r-updated" style="font-weight:700;margin:.25rem 0 0;">â€”</div>
          <div class="small" style="margin-top:.65rem;">Progreso estimado</div>
          <div class="progress-bar" style="margin-top:.35rem;">
            <div class="progress-fill" id="r-progress" style="width:0%;"></div>
          </div>
          <div class="small" id="r-progress-text" style="margin-top:.35rem;">0%</div>
          <button class="btn btn-ghost" id="r-print" style="margin-top:.75rem;width:100%;">ğŸ–¨ï¸ Exportar a PDF</button>
        </div>

        <div class="card">
          <h3>âœ… Indicadores</h3>
          <ul class="list">
            <li><strong>PEVE:</strong> <span id="k-peve">â€”</span></li>
            <li><strong>DIA:</strong> <span id="k-dia">â€”</span></li>
            <li><strong>KPSI:</strong> <span id="k-kpsi">â€”</span></li>
          </ul>
          <p class="small note">Estos indicadores se completan cuando el Apps Script provee datos.</p>
        </div>
      </div>
    </section>

    <section class="section">
      <article class="card">
        <h2>ğŸ“„ Detalle (modo demo / real)</h2>
        <div class="note small">Si estÃ¡s en modo demo, este contenido muestra un ejemplo. Si estÃ¡s conectado, se reemplaza con datos reales.</div>
        <div id="r-detail" style="margin-top:1rem;">
          <div class="note">No hay datos cargados aÃºn.</div>
        </div>
      </article>
    </section>

    <section class="section">
      <article class="card accessibility-card" aria-label="InformaciÃ³n de accesibilidad de la plataforma PEVE">
        <h2>ğŸ§© Accesibilidad</h2>
        <p class="note">ğŸ› ï¸ Controles: ğŸ  inicio Â· ğŸ—£ï¸ lee todo el contenido de la pÃ¡gina Â· ğŸŒ“ alto contraste Â· A+ / Aâˆ’ tamaÃ±o de letra Â· ğŸŒ ES / EN / FR (traducciÃ³n del sitio) Â· ğŸ§  guÃ­a paso a paso Â· ğŸ” lupa.</p>
      </article>
    </section>
  </main>

  <footer class="footer small"></footer>

  <script src="../../assets/api.js"></script>
  <script src="../../assets/js/accesibilidad.js"></script>
  <script src="../../assets/js/footer.js"></script>
  <script>
    (function(){
      const status = document.getElementById('g-status');
      const detail = document.getElementById('r-detail');
      const updated = document.getElementById('r-updated');
      const progressFill = document.getElementById('r-progress');
      const progressText = document.getElementById('r-progress-text');
      const kpeve = document.getElementById('k-peve');
      const kdia = document.getElementById('k-dia');
      const kkpsi = document.getElementById('k-kpsi');

      function setDemo(){
        const now = new Date();
        updated.textContent = now.toLocaleString();
        const pct = 42;
        progressFill.style.width = pct+'%';
        progressText.textContent = pct+'%';
        kpeve.textContent = 'En curso';
        kdia.textContent = 'Pendiente';
        kkpsi.textContent = 'Inicial';
        detail.innerHTML = `
          <div class="card" style="margin-top:.75rem;">
            <h3>ğŸ“Œ RecomendaciÃ³n (demo)</h3>
            <p>Avanza con rutinas cortas (15â€“25 min), repasa temarios oficiales y registra progreso semanal. Si hay ansiedad o barreras de acceso, coordina apoyos con PIE.</p>
          </div>
          <div class="card" style="margin-top:.75rem;">
            <h3>ğŸ§¾ PrÃ³ximos pasos</h3>
            <ol>
              <li>Revisar temarios del curso del estudiante.</li>
              <li>Practicar con evaluaciones formativas (DIA) si corresponde.</li>
              <li>Registrar KPSI inicial y comparar en 4 semanas.</li>
            </ol>
          </div>
        `;
      }

      async function loadReal(run, idpeve){
        // acciÃ³n sugerida para Apps Script (puedes implementarla en tu backend)
        // action: "guardianReport"
        const payload = { run, idPeve: idpeve };
        const res = await pevePost("guardianReport", payload);
        // Espera un formato flexible:
        // { ok:true, updated:"...", progress:0-100, k:{peve,dia,kpsi}, detailHtml:"..." }
        if(!res || !res.ok) throw new Error(res && res.error ? res.error : "Respuesta invÃ¡lida");
        updated.textContent = res.updated || new Date().toLocaleString();
        const pct = Math.max(0, Math.min(100, Number(res.progress||0)));
        progressFill.style.width = pct+'%';
        progressText.textContent = pct+'%';
        kpeve.textContent = (res.k && res.k.peve) || 'â€”';
        kdia.textContent = (res.k && res.k.dia) || 'â€”';
        kkpsi.textContent = (res.k && res.k.kpsi) || 'â€”';
        detail.innerHTML = res.detailHtml || '<div class="note">Sin detalle.</div>';
      }

      document.getElementById('g-load').addEventListener('click', async ()=>{
        const run = document.getElementById('g-run').value.trim();
        const idp = document.getElementById('g-idpeve').value.trim();
        status.textContent = 'Cargando...';
        try{
          if(!run && !idp){
            status.textContent = 'Ingresa RUN o ID PEVE.';
            return;
          }
          await loadReal(run, idp);
          status.textContent = 'Informe cargado.';
        }catch(e){
          status.textContent = 'Modo demo: ' + (e && e.message ? e.message : 'No hay conexiÃ³n');
          setDemo();
        }
      });

      document.getElementById('r-print').addEventListener('click', ()=> window.print());
    })();
  </script>
  <script src="../../assets/js/guardian-context.js" defer></script>
</body>
</html>
