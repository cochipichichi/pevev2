<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>üõ†Ô∏è Panel Administrador ‚Äì üìöPEVE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../assets/css/style.css" />
</head>
<body class="theme-dark">

  <!-- GUARDIA DE SESI√ìN ADMIN -->
  <script>
    (function () {
      try {
        const isAdmin = sessionStorage.getItem("adminLogged") === "1";
        if (!isAdmin) {
          window.location.href = "./login.html";
        }
      } catch (e) {
        window.location.href = "./login.html";
      }
    })();
  </script>

  <!-- HEADER GLOBAL -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle">üìö</div>
      <div class="brand-text">
        <span class="brand-name">PEVE</span>
        <span class="brand-subtitle">Panel de administraci√≥n</span>
      </div>
    </div>

    <nav class="topbar-nav" aria-label="Navegaci√≥n principal">
      <a href="../index.html" class="nav-link">Inicio</a>
      <a href="../pages/asignaturas.html" class="nav-link">Asignaturas</a>
      <span class="nav-link nav-link-active">Administrador</span>
      <a href="./informes.html" class="nav-link">Informes</a>
    </nav>

    <div class="accessibility-toolbar" aria-label="Controles de accesibilidad">
      <button class="access-btn btn-icon" data-action="toggle-theme" aria-label="Cambiar tema claro/oscuro">üåì</button>
      <button class="access-btn btn-icon" data-action="font-dec" aria-label="Disminuir tama√±o de letra">A‚àí</button>
      <button class="access-btn btn-icon" data-action="font-inc" aria-label="Aumentar tama√±o de letra">A+</button>
      <button class="access-btn btn-icon" data-action="narrator" aria-label="Activar narrador">üîä</button>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main id="main-content" class="page">

    <!-- RESUMEN SUPERIOR -->
    <section class="section">
      <div class="section-header">
        <h1>Panel administrador</h1>
        <p class="page-lead">
          Gestiona usuarios PEVE, credenciales de acceso e informes de resultados (PEVE, DIA y KPSI) para estudiantes,
          apoderados, docentes y UTP.
        </p>
      </div>

      <div class="dashboard-grid">
        <article class="card">
          <h3>üë• Usuarios PEVE</h3>
          <p class="note">
            Total de estudiantes cargados desde la hoja <code>PEVE_Usuarios</code>.
          </p>
          <p><strong id="admin-total-users">‚Äì</strong> estudiante(s)</p>
        </article>

        <article class="card">
          <h3>üì© Env√≠o de credenciales</h3>
          <p class="note">
            Selecciona un estudiante en la tabla y utiliza los botones para enviar las credenciales por correo o
            WhatsApp al apoderado.
          </p>
        </article>

        <article class="card">
          <h3>üìä Informes y resultados</h3>
          <p class="note">
            Genera y comparte informes PEVE (resultados, DIA, KPSI) desde este panel o en el m√≥dulo detallado de
            <strong>Informes</strong>.
          </p>
          <a href="./informes.html" class="btn btn-outline btn-card">Ir a informes detallados</a>
        </article>
      </div>
    </section>

    <!-- TABLA DE USUARIOS PEVE -->
    <section class="section">
      <div class="section-header">
        <h2>Gesti√≥n de usuarios PEVE</h2>
        <p>
          Datos sincronizados desde la hoja <code>PEVE_Usuarios</code> (o datos demo mientras se configura la API de
          Google Sheets). Selecciona un estudiante para trabajar informes y credenciales.
        </p>
      </div>

      <div class="table-wrapper">
        <table class="temario-table" id="admin-users-table">
          <thead>
            <tr>
              <th>ID PEVE</th>
              <th>Estudiante</th>
              <th>RUT</th>
              <th>Curso 2025</th>
              <th>Llamado</th>
              <th>Correo estudiante</th>
              <th>Apoderado</th>
              <th>Correo apoderado</th>
              <th>Tel√©fono apoderado</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <!-- Filas din√°micas desde admin.js -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- INFORMES R√ÅPIDOS PEVE ¬∑ DIA ¬∑ KPSI -->
    <section class="section admin-report-section">
      <div class="section-header">
        <h2>Informes r√°pidos PEVE ¬∑ DIA ¬∑ KPSI</h2>
        <p class="page-lead">
          A partir del estudiante seleccionado puedes generar un informe breve para distintos destinatarios:
          estudiante, apoderado, docente o UTP / Equipo PIE. PEVE integra resultados de ex√°menes, informaci√≥n de
          ingreso (DIA) y KPSI inicio / fin como insumos para el seguimiento.
        </p>
      </div>

      <div class="admin-report-steps callout-secondary">
        <p>
          <strong>Flujo sugerido:</strong>
          1Ô∏è‚É£ Selecciona un estudiante en la tabla superior ¬∑
          2Ô∏è‚É£ Elige tipo de informe y destinatario ¬∑
          3Ô∏è‚É£ Ajusta el texto si lo deseas ¬∑
          4Ô∏è‚É£ Env√≠a por correo o WhatsApp.
        </p>
        <p class="note">
          Por ahora el contenido es una plantilla demostrativa. M√°s adelante podr√°s inyectar resultados reales de
          PEVE, DIA y KPSI desde tus hojas de c√°lculo.
        </p>
      </div>

      <div class="admin-report-grid">
        <!-- Columna izquierda: configuraci√≥n + texto del informe -->
        <article class="card admin-report-main">
          <header class="admin-report-header">
            <span class="page-kicker">Informe r√°pido ¬∑ Borrador editable</span>
            <h3>Configuraci√≥n del informe</h3>
          </header>

          <div class="admin-report-student">
            <span class="admin-report-label">Estudiante seleccionado</span>
            <p id="report-student-label" class="admin-report-student-name">
              Sin selecci√≥n ¬∑ selecciona una fila en la tabla de usuarios.
            </p>
          </div>

          <div class="admin-report-form">
            <div class="admin-report-field">
              <label for="report-type-select">Tipo de informe</label>
              <select id="report-type-select" class="admin-report-select">
                <option value="resumen-peve">Resumen PEVE (ex√°menes + avance)</option>
                <option value="dia">Informe de ingreso (DIA)</option>
                <option value="kpsi">Informe KPSI inicio / fin</option>
                <option value="mixto">Informe mixto (PEVE + DIA + KPSI)</option>
              </select>
            </div>

            <div class="admin-report-field">
              <label for="report-target-select">Destinatario principal</label>
              <select id="report-target-select" class="admin-report-select">
                <option value="estudiante">Estudiante</option>
                <option value="apoderado">Apoderado / tutor / cuidador</option>
                <option value="docente">Docente</option>
                <option value="utp">UTP / Equipo PIE</option>
              </select>
            </div>

            <div class="admin-report-tags">
              <button type="button" class="report-tag" data-report-type="dia">
                DIA ¬∑ l√≠nea de base
              </button>
              <button type="button" class="report-tag" data-report-type="kpsi">
                KPSI inicio / fin
              </button>
              <button type="button" class="report-tag" data-report-type="resumen-peve">
                Resultados por curso y asignatura
              </button>
              <button type="button" class="report-tag" data-report-type="mixto">
                Informe mixto (PEVE + DIA + KPSI)
              </button>
            </div>

            <div class="admin-report-field">
              <label for="report-preview">
                Vista previa del informe (puedes editar el texto antes de enviar)
              </label>
              <textarea id="report-preview"
                        rows="14"
                        class="admin-report-textarea"></textarea>
            </div>
          </div>
        </article>

        <!-- Columna derecha: tips + acciones de env√≠o -->
        <aside class="card admin-report-side">
          <h3>Uso de este informe</h3>
          <ul class="bullet-list small">
            <li>Ajusta el tono y el detalle seg√∫n el destinatario (estudiante, familia, docente o UTP / PIE).</li>
            <li>Puedes copiar el texto para informes DIA, actas de reuni√≥n o fichas de seguimiento interno.</li>
            <li>A futuro se incorporar√°n datos reales de PEVE, DIA y KPSI (gr√°ficos, porcentajes, etc.).</li>
          </ul>

          <div class="admin-report-actions">
            <button id="btn-report-email" type="button" class="btn btn-solid">
              üì© Enviar informe por correo
            </button>
            <button id="btn-report-whatsapp" type="button" class="btn btn-outline">
              üì± Enviar informe por WhatsApp
            </button>
            <a href="./informes.html" class="btn btn-ghost btn-card">
              Ver m√≥dulo de informes completo
            </a>
          </div>

          <p class="note admin-report-note">
            Estos botones usan el correo / tel√©fono del estudiante o apoderado asociado al registro seleccionado
            en la tabla. M√°s adelante podr√°s integrar correos de docentes y UTP espec√≠ficos por curso.
          </p>
        </aside>
      </div>
    </section>
  </main>

  <!-- JS GLOBAL -->
  <script src="../assets/js/accesibilidad.js" defer></script>
  <script src="../assets/js/footer.js" defer></script>
  <script src="../assets/js/admin.js" defer></script>
</body>
</html>
