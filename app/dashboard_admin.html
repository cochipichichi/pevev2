<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>üõ†Ô∏è Panel Administrador ‚Äì üìöPEVE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../assets/css/style.css" />
</head>
<body class="theme-dark">

  <!-- GUARDIA DE SESI√ìN ADMIN -->
  <script>
    (function () {
      try {
        const isAdmin = sessionStorage.getItem("adminLogged") === "1";
        if (!isAdmin) {
          window.location.href = "./login.html";
        }
      } catch (e) {
        window.location.href = "./login.html";
      }
    })();
  </script>

  <!-- HEADER GLOBAL -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle">üìö</div>
      <div class="brand-text">
        <span class="brand-name">PEVE</span>
        <span class="brand-subtitle">Panel de administraci√≥n</span>
      </div>
    </div>

    <nav class="topbar-nav" aria-label="Navegaci√≥n principal">
      <a href="../index.html" class="nav-link">Inicio</a>
      <a href="../pages/asignaturas.html" class="nav-link">Asignaturas</a>
      <span class="nav-link nav-link-active">Administrador</span>
      <a href="./informes.html" class="nav-link">Informes</a>
    </nav>

    <div class="accessibility-toolbar" aria-label="Controles de accesibilidad">
      <button class="access-btn btn-icon" data-action="toggle-theme" aria-label="Cambiar tema claro/oscuro">üåì</button>
      <button class="access-btn btn-icon" data-action="font-dec" aria-label="Disminuir tama√±o de letra">A‚àí</button>
      <button class="access-btn btn-icon" data-action="font-inc" aria-label="Aumentar tama√±o de letra">A+</button>
      <button class="access-btn btn-icon" data-action="narrator" aria-label="Activar narrador">üîä</button>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main id="main-content" class="page">
    <section class="section">
      <div class="section-header">
        <h1>Panel administrador</h1>
        <p class="page-lead">
          Gestiona usuarios PEVE, credenciales de acceso e informes de resultados (PEVE, DIA y KPSI) para estudiantes, apoderados, docentes y UTP.
        </p>
      </div>

      <!-- RESUMEN SUPERIOR -->
      <div class="dashboard-grid">
        <article class="card">
          <h3>üë• Usuarios PEVE</h3>
          <p class="note">
            Total de estudiantes cargados desde la hoja <code>PEVE_Usuarios</code>.
          </p>
          <p><strong id="admin-total-users">‚Äì</strong> estudiante(s)</p>
        </article>

        <article class="card">
          <h3>üì© Env√≠o de credenciales</h3>
          <p class="note">
            Selecciona un estudiante en la tabla y utiliza los botones para enviar las credenciales por correo o WhatsApp al apoderado.
          </p>
        </article>

        <article class="card">
          <h3>üìä Informes y resultados</h3>
          <p class="note">
            Genera y comparte informes PEVE (resultados, DIA, KPSI) desde este panel o en el m√≥dulo detallado de <strong>Informes</strong>.
          </p>
          <a href="./informes.html" class="btn btn-outline btn-card">Ir a informes detallados</a>
        </article>
      </div>

      <!-- TABLA DE USUARIOS PEVE -->
      <section class="section">
        <div class="section-header">
          <h2>Gesti√≥n de usuarios PEVE</h2>
          <p>
            Datos sincronizados desde la hoja <code>PEVE_Usuarios</code> (o datos demo mientras se configura la API de Google Sheets).
            Selecciona un estudiante para trabajar informes y credenciales.
          </p>
        </div>

        <div class="table-wrapper">
          <table class="temario-table" id="admin-users-table">
            <thead>
              <tr>
                <th>ID PEVE</th>
                <th>Estudiante</th>
                <th>RUT</th>
                <th>Curso 2025</th>
                <th>Llamado</th>
                <th>Correo estudiante</th>
                <th>Apoderado</th>
                <th>Correo apoderado</th>
                <th>Tel√©fono apoderado</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filas din√°micas desde admin.js -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- M√ìDULO DE INFORMES R√ÅPIDOS (PEVE + DIA + KPSI) -->
      <section class="section">
        <div class="section-header">
          <h2>Informes r√°pidos PEVE ¬∑ DIA ¬∑ KPSI</h2>
          <p>
            A partir del estudiante seleccionado puedes generar un informe breve para distintos destinatarios:
            estudiante, apoderado, docente o UTP / Equipo PIE. PEVE integra resultados de ex√°menes,
            informaci√≥n de ingreso (DIA) y KPSI inicio / fin como insumos para el seguimiento.
          </p>
        </div>

        <article class="card">
          <div class="login-header-row">
            <div>
              <p class="note">
                1Ô∏è‚É£ Selecciona un estudiante en la tabla superior ¬∑
                2Ô∏è‚É£ Elige tipo de informe y destinatario ¬∑
                3Ô∏è‚É£ Ajusta el mensaje si lo deseas ¬∑
                4Ô∏è‚É£ Env√≠a por correo o WhatsApp.
              </p>
              <p class="note">
                Por ahora el contenido es una plantilla demostrativa. M√°s adelante podr√°s inyectar
                resultados reales de PEVE, DIA y KPSI desde tus hojas de c√°lculo.
              </p>
            </div>
            <div class="login-badge">
              Informe r√°pido ¬∑ Borrador editable
            </div>
          </div>

          <!-- FILTROS B√ÅSICOS DE INFORME -->
          <div class="dashboard-grid">
            <div>
              <label class="note" for="report-student-label">
                Estudiante seleccionado
              </label>
              <p id="report-student-label">
                <strong>Sin selecci√≥n</strong> ¬∑ selecciona una fila en la tabla de usuarios.
              </p>

              <div class="progress-group" style="margin-top:0.75rem;">
                <label for="report-type-select">Tipo de informe</label>
                <select id="report-type-select" class="login-form-input" style="width:100%; max-width:320px; border-radius:999px; padding:0.45rem 0.85rem; background:rgba(15,23,42,0.9); border:1px solid rgba(148,163,184,0.6); color:#e5e7eb;">
                  <option value="resumen-peve">Resumen PEVE (ex√°menes + avance)</option>
                  <option value="dia">Informe de ingreso (DIA)</option>
                  <option value="kpsi">Informe KPSI inicio / fin</option>
                  <option value="mixto">Informe mixto (PEVE + DIA + KPSI)</option>
                </select>
              </div>

              <div class="progress-group">
                <label for="report-target-select">Destinatario principal</label>
                <select id="report-target-select" class="login-form-input" style="width:100%; max-width:320px; border-radius:999px; padding:0.45rem 0.85rem; background:rgba(15,23,42,0.9); border:1px solid rgba(148,163,184,0.6); color:#e5e7eb;">
                  <option value="estudiante">Estudiante</option>
                  <option value="apoderado">Apoderado / tutor / cuidador</option>
                  <option value="docente">Docente</option>
                  <option value="utp">UTP / Equipo PIE</option>
                </select>
              </div>

             <div class="hero-meta" style="margin-top:0.75rem;">
            <button type="button" class="meta-pill report-tag" data-report-type="dia">
              DIA ¬∑ l√≠nea de base
            </button>
            <button type="button" class="meta-pill report-tag" data-report-type="kpsi">
              KPSI inicio / fin
            </button>
            <button type="button" class="meta-pill report-tag" data-report-type="resumen-peve">
              Resultados por curso y asignatura
            </button>
          </div>


            <!-- PREVIEW DEL INFORME -->
            <div>
              <label class="note" for="report-preview">
                Vista previa del informe (puedes editar el texto antes de enviar)
              </label>
              <textarea
                id="report-preview"
                rows="10"
                style="width:100%; margin-top:0.4rem; border-radius:18px; padding:0.75rem 0.9rem; background:rgba(15,23,42,0.96); border:1px solid rgba(148,163,184,0.6); color:#e5e7eb; font-size:0.85rem; resize:vertical;"
              >
[INFORME DEMO PEVE ‚Äì COMPLETAR]

Estimada familia / equipo,

A continuaci√≥n se presenta un borrador de informe del estudiante [NOMBRE_ESTUDIANTE], curso [CURSO_2025], llamado [LLAMADO]:

1. Informaci√≥n de ingreso (DIA)
   - L√≠nea de base de aprendizaje al momento de ingresar a PEVE.
   - Principales fortalezas y necesidades detectadas.

2. Progreso en PEVE (por curso y asignatura)
   - Avance en revisi√≥n de temarios oficiales.
   - Resultados de evaluaciones realizadas en la plataforma.
   - Trayectoria y ritmo de estudio.

3. KPSI inicio / KPSI fin
   - Percepci√≥n inicial del estudiante respecto a los Objetivos de Aprendizaje.
   - Cambios en la percepci√≥n al cierre del proceso (mayor seguridad / autonom√≠a).

Este informe es una s√≠ntesis para apoyar el trabajo conjunto entre estudiante, familia, docentes y UTP/PIE. Pr√≥ximas versiones incluir√°n gr√°ficas y detalles cuantitativos a partir de los registros de la plataforma.

Atentamente,
Equipo PEVE ‚Äì Liceo San Nicol√°s / Neotech EduLab
              </textarea>

              <p class="note" style="margin-top:0.45rem;">
                M√°s adelante este texto se generar√° autom√°ticamente en base a resultados reales
                (PEVE, DIA, KPSI y evaluaciones por asignatura).
              </p>
            </div>
          </div>

          <!-- BOTONES DE ENV√çO -->
          <div class="hero-cta-group" style="margin-top:1.1rem;">
            <button type="button" class="btn btn-solid pulse" id="btn-report-email">
              üì© Enviar informe por correo
            </button>
            <button type="button" class="btn btn-outline pulse" id="btn-report-whatsapp">
              üì± Enviar informe por WhatsApp
            </button>
            <a href="./informes.html" class="btn btn-ghost btn-card">
              Ver m√≥dulo de informes completo
            </a>
          </div>

          <p class="note" style="margin-top:0.4rem;">
            Estos botones podr√≠an usar el correo / tel√©fono del apoderado, docente o contacto UTP asociado
            al estudiante seleccionado en la tabla. La l√≥gica fina se implementar√° en <code>admin.js</code>
            a medida que se integren los datos reales de resultados.
          </p>
        </article>
      </section>
    </section>
  </main>

  <!-- FOOTER + JS -->
  <script src="../assets/js/accesibilidad.js" defer></script>
  <script src="../assets/js/footer.js" defer></script>
  <script src="../assets/js/admin.js" defer></script>
</body>
</html>
