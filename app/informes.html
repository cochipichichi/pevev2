<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>üìä Informes PEVE ¬∑ DIA ¬∑ KPSI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../assets/css/style.css" />
</head>
<body class="theme-dark">

  <!-- HEADER GLOBAL PEVE -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle">üìö</div>
      <div class="brand-text">
        <span class="brand-name">PEVE</span>
        <span class="brand-subtitle">M√≥dulo de informes</span>
      </div>
    </div>

    <nav class="topbar-nav" aria-label="Navegaci√≥n principal">
      <a href="../index.html" class="nav-link">Inicio</a>
      <a href="../pages/info.html" class="nav-link">Proceso</a>
      <a href="../pages/niveles.html" class="nav-link">Niveles</a>
      <a href="../pages/asignaturas.html" class="nav-link">Asignaturas</a>
      <a href="./dashboard.html" class="nav-link">Estudiante</a>
      <a href="./dashboard_admin.html" class="nav-link">Administrador</a>
      <span class="nav-link nav-link-active">Informes</span>
    </nav>

    <div class="accessibility-toolbar" aria-label="Controles de accesibilidad">
      <button class="access-btn btn-icon" data-action="toggle-theme" aria-label="Cambiar tema claro/oscuro">üåì</button>
      <button class="access-btn btn-icon" data-action="font-dec" aria-label="Disminuir tama√±o de letra">A‚àí</button>
      <button class="access-btn btn-icon" data-action="font-inc" aria-label="Aumentar tama√±o de letra">A+</button>
      <button class="access-btn btn-icon" data-action="narrator" aria-label="Activar narrador de la p√°gina">üîä</button>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main id="main-content" class="page">
    <header class="page-header">
      <p class="page-kicker">Seguimiento acad√©mico</p>
      <h1>Informes PEVE ¬∑ DIA ¬∑ KPSI</h1>
      <p class="page-lead">
        Este m√≥dulo permite a UTP, PIE y docentes revisar resultados por curso y asignatura, combinando
        informaci√≥n de PEVE (ex√°menes y temarios), DIA (Diagn√≥stico Integral de Aprendizajes) y KPSI
        (inicio / fin) para tomar decisiones pedag√≥gicas.
      </p>
    </header>

    <!-- FILTROS SUPERIORES -->
    <section class="section">
      <div class="card">
        <h2>Filtros de informe</h2>
        <p class="note">
          Selecciona curso, asignatura y llamado para actualizar la vista. Por ahora los datos son de
          demostraci√≥n; m√°s adelante se conectar√°n a hojas como <code>PEVE_Resultados</code>,
          <code>DIA_Resultados</code> y <code>KPSI_Resultados</code>.
        </p>

        <form class="hero-cta-group" id="filters-form">
          <label>
            <span style="font-size:0.8rem;">Curso 2025</span>
            <select id="filter-curso" class="btn btn-ghost" style="min-width:150px;">
              <option>1¬∞ Medio</option>
              <option>2¬∞ Medio</option>
              <option>3¬∞ Medio</option>
              <option>4¬∞ Medio</option>
            </select>
          </label>

          <label>
            <span style="font-size:0.8rem;">Asignatura</span>
            <select id="filter-asignatura" class="btn btn-ghost" style="min-width:180px;">
              <option>Biolog√≠a 1¬∞ Medio (BIO1M)</option>
              <option>Lengua y Literatura</option>
              <option>Matem√°tica</option>
              <option>Historia y Cs. Sociales</option>
            </select>
          </label>

          <label>
            <span style="font-size:0.8rem;">Llamado</span>
            <select id="filter-llamado" class="btn btn-ghost" style="min-width:170px;">
              <option>2025 ¬∑ 1¬∞ llamado</option>
              <option>2025 ¬∑ 2¬∞ llamado</option>
              <option>2026 ¬∑ 1¬∞ llamado</option>
            </select>
          </label>

          <label>
            <span style="font-size:0.8rem;">Tipo de informe</span>
            <select id="filter-tipo" class="btn btn-ghost" style="min-width:190px;">
              <option>PEVE (ex√°menes / temarios)</option>
              <option>DIA (ingreso / cierre)</option>
              <option>KPSI (inicio / fin)</option>
              <option>Mixto (PEVE + DIA + KPSI)</option>
            </select>
          </label>

          <button type="button" class="btn btn-solid pulse" id="btn-actualizar">
            Actualizar vista
          </button>
        </form>
      </div>
    </section>


    <!-- CONEXI√ìN LIVE (Apps Script) -->
    <section class="section">
      <div class="card">
        <h2 data-i18n="informes.connectTitle">Conexi√≥n a Google Sheets (Apps Script)</h2>
        <p class="note" data-i18n="informes.connectNote">
          Pega la URL de tu Web App (termina en <code>/exec</code>). Se guarda en este navegador (localStorage).
        </p>

        <div class="hero-cta-group" style="align-items:flex-end; gap:10px; flex-wrap:wrap;">
          <label>
            <span style="font-size:0.8rem;" data-i18n="informes.endpointLabel">Endpoint /exec</span>
            <input id="script-url" class="input" placeholder="https://script.google.com/macros/s/.../exec" style="min-width:340px; max-width:100%;">
          </label>

          <button id="btn-save-script" class="btn" type="button" data-i18n="informes.saveLoad">Guardar y cargar</button>
          <small id="script-status" class="note" style="margin:0;">‚Äî</small>
          <small id="live-status" class="note" style="margin:0;">‚Äî</small>
        </div>
      </div>
    </section>

    <!-- RESUMEN EJECUTIVO -->
    <section class="section">
      <div class="section-header">
        <h2>Resumen ejecutivo del curso</h2>
        <p class="page-lead">
          Indicadores r√°pidos para reuniones de ciclo, UTP o informes con direcci√≥n. Con el endpoint configurado, estos valores se calculan desde tus hojas PEVE/DIA/KPSI.
        </p>
      </div>

      <div class="dashboard-grid">
        <article class="card">
          <h3>üë• Estudiantes del curso</h3>
          <p class="note">Total de estudiantes que rinden PEVE en el curso seleccionado.</p>
          <p><strong id="kpi-total-estudiantes">28</strong> estudiante(s)</p>
        </article>

        <article class="card">
          <h3>‚úÖ Avance en PEVE</h3>
          <p class="note">Porcentaje que complet√≥ todos los temarios y evaluaciones clave.</p>
          <p><strong id="kpi-avance-completo">68 %</strong> con avance completo (demo)</p>
        </article>

        <article class="card">
          <h3>üìà Mejora KPSI</h3>
          <p class="note">Estudiantes que muestran mejora entre KPSI inicio y KPSI fin.</p>
          <p><strong id="kpi-kpsi-mejora">74 %</strong> con mejora positiva (demo)</p>
        </article>

        <article class="card">
          <h3>üìä Promedios PEVE / DIA</h3>
          <ul class="bullet-list small">
            <li><strong data-i18n="informes.avgPeveLabel">Promedio PEVE asignatura:</strong> <span id="kpi-prom-peve">‚Äî</span></li>
            <li><strong data-i18n="informes.avgDiaLabel">Promedio DIA ingreso:</strong> <span id="kpi-prom-dia-ingreso">‚Äî</span></li>
            <li><strong data-i18n="informes.goalLabel">Meta:</strong> <span data-i18n="informes.goalText">Subir al menos 0,5 puntos entre ingreso y cierre.</span></li>
          </ul>
        </article>
      </div>
      <div class="grid-2" style="margin-top:14px;">
        <div class="chart-card">
          <h3 data-i18n="informes.chartAsigTitle">üìå Resumen por asignatura</h3>
          <p class="note" data-i18n="informes.chartAsigNote">Promedio PEVE por asignatura (seg√∫n filtros).</p>
          <canvas id="chart-asignaturas" class="chart-canvas"></canvas>
        </div>
        <div class="chart-card">
          <h3 data-i18n="informes.chartTrendTitle">üóìÔ∏è Tendencia</h3>
          <p class="note" data-i18n="informes.chartTrendNote">Evoluci√≥n de promedio PEVE (por mes, si hay fechas).</p>
          <canvas id="chart-trend" class="chart-canvas"></canvas>
        </div>
      </div>


    </section>

    <!-- TABLA DETALLE POR ESTUDIANTE -->
    <section class="section">
      <div class="section-header">
        <h2>Detalle por estudiante</h2>
        <p class="page-lead">
          Tabla pensada para reuniones de curso, trabajo con PIE y an√°lisis de brechas. Puedes exportarla
          a CSV o imprimirla en versi√≥n resumida.
        </p>
      </div>

      <div class="table-wrapper">
        <table class="temario-table" id="tabla-informes">
          <thead>
            <tr>
              <th>Estudiante</th>
              <th>Curso</th>
              <th>Llamado</th>
              <th>% avance PEVE</th>
              <th>Resultado PEVE</th>
              <th>DIA ingreso</th>
              <th>DIA cierre</th>
              <th>KPSI inicio</th>
              <th>KPSI fin</th>
              <th>Alertas</th>
              <th>Informe</th>
            </tr>
          </thead>
          <tbody>
            <!-- Filas generadas autom√°ticamente desde Sheets -->
          </tbody>
        </table>

        <div class="table-controls">
          <button id="btn-export-csv" class="btn small" type="button" data-i18n="informes.exportCsv">Exportar CSV</button>
          <div id="table-pager" class="pager"></div>
        </div>
      </div>

      <div class="hero-meta" style="margin-top:0.8rem;">
        <button class="btn btn-outline btn-card">Exportar CSV (para UTP)</button>
        <button class="btn btn-outline btn-card">Versi√≥n para imprimir / PDF</button>
      </div>
    </section>

    <!-- PANEL DE INFORME INDIVIDUAL (BORRADOR EDITABLE) -->
    <section class="section">
      <div class="section-header">
        <h2>Informe individual PEVE ¬∑ DIA ¬∑ KPSI</h2>
        <p class="page-lead">
          Borrador editable para compartir con familias, docentes o equipos externos. M√°s adelante este
          texto se podr√° generar autom√°ticamente desde los resultados reales del estudiante.
        </p>
      </div>

      <div class="dashboard-grid">
        <article class="card">
          <h3>Configuraci√≥n r√°pida del informe</h3>
          <p class="note">
            1) Selecciona un estudiante en la tabla ¬∑ 2) Ajusta el tipo de informe y destinatario ¬∑
            3) Edita el texto si lo necesitas ¬∑ 4) Env√≠a por correo o WhatsApp.
          </p>

          <div class="progress-group">
            <label>Estudiante seleccionado</label>
            <p id="report-student-label"><em>Sin selecci√≥n ¬∑ usa la tabla de arriba.</em></p>
          </div>

          <div class="progress-group">
            <label for="report-type">Tipo de informe</label>
            <select id="report-type" class="btn btn-ghost" style="width:100%;">
              <option>Resumen PEVE (ex√°menes + avance)</option>
              <option>DIA ¬∑ l√≠nea de base</option>
              <option>KPSI inicio / fin</option>
              <option>Resultados por curso y asignatura</option>
            </select>
          </div>

          <div class="progress-group">
            <label for="report-target">Destinatario principal</label>
            <select id="report-target" class="btn btn-ghost" style="width:100%;">
              <option>Estudiante</option>
              <option>Apoderado / familia</option>
              <option>Docente</option>
              <option>UTP / Equipo PIE</option>
            </select>
          </div>

          <div class="hero-meta" style="margin-top:1rem;">
            <button class="btn btn-solid pulse" id="btn-report-email">üì© Enviar por correo</button>
            <button class="btn btn-outline" id="btn-report-whatsapp">üì± Enviar por WhatsApp</button>
          </div>

          <p class="note" style="margin-top:0.6rem;">
            Estos botones podr√°n utilizar el correo / tel√©fono del apoderado, docente o UTP
            asociados al estudiante seleccionado en la tabla de arriba. La l√≥gica fina se
            implementar√° en <code>admin.js</code> cuando conectemos resultados reales.
          </p>
        </article>

        <article class="card">
          <h3>Vista previa del informe (editable)</h3>
          <p class="note">
            Puedes editar libremente este texto antes de enviarlo. M√°s adelante se generar√°
            autom√°ticamente con datos PEVE ¬∑ DIA ¬∑ KPSI.
          </p>
          <textarea
            id="report-preview"
            style="width:100%;min-height:280px;border-radius:14px;border:1px solid rgba(148,163,184,0.6);background:rgba(15,23,42,0.96);color:#e5e7eb;padding:0.8rem;font-size:0.82rem;font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;"
          >[INFORME DEMO PEVE ‚Äì COMPLETAR]

Estimada familia / equipo,

A continuaci√≥n se presenta un borrador de informe del estudiante [NOMBRE_ESTUDIANTE],
curso [CURSO_2025], llamado [LLAMADO]:

1. Informaci√≥n de ingreso (DIA)
   - L√≠nea de base de aprendizaje al momento de ingresar a PEVE.
   - Principales fortalezas y necesidades detectadas.

2. Progreso en PEVE
   - Avance en revisi√≥n de temarios y materiales.
   - Resultados de evaluaciones realizadas en la plataforma.
   - Ritmo de estudio y participaci√≥n en las actividades propuestas.

3. KPSI inicio / fin
   - Percepci√≥n de dominio al inicio del proceso.
   - Cambios en la autopercepci√≥n al cierre del per√≠odo.

Este informe es una s√≠ntesis para apoyar el trabajo conjunto entre estudiante, familia,
docentes y UTP / PIE. Pr√≥ximas versiones incluir√°n gr√°ficas y detalles cuantitativos a
partir de los registros reales de la plataforma.

Atentamente,
Equipo PEVE ‚Äì Liceo San Nicol√°s / Neotech EduLab</textarea>
        </article>
      </div>
    </section>

    <!-- NOTA FINAL -->
    <section class="section">
      <div class="callout-secondary callout">
        <h3>¬øC√≥mo se integran PEVE, DIA y KPSI en la pr√°ctica?</h3>
        <p class="note">
          La intenci√≥n del m√≥dulo de informes es que el liceo pueda conectar:
        </p>
        <ul class="bullet-list small">
          <li>Resultados de ex√°menes PEVE por curso y asignatura.</li>
          <li>Informaci√≥n de ingreso y cierre del DIA (MINEDUC).</li>
          <li>KPSI de inicio / fin como indicador de percepci√≥n de logro.</li>
        </ul>
        <p class="note">
          Con esa triada, UTP y PIE pueden identificar estudiantes que requieren apoyos,
          monitorear avances y generar informes claros para familias y redes externas.
        </p>
      </div>
    </section>
  </main>

  <!-- JS COM√öN -->
  <script src="../assets/js/accesibilidad.js" defer></script>
  <script src="../assets/js/config.js" defer></script>
  <script src="../assets/js/charts-mini.js" defer></script>
  <script src="../assets/js/informes.js" defer></script>
  <script src="../assets/js/footer.js" defer></script>
</body>
</html>
