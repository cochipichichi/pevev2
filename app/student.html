<!doctype html>
<html lang="es"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ‘©â€ğŸ“Estudiante â€” ğŸ“šPEVE</title>
<link rel="stylesheet" href="../assets/style.css">
<script defer src="../assets/app.js"></script>

<script>
window.addEventListener('DOMContentLoaded', async()=>{
  const u = (typeof getSession === 'function') ? getSession() : null;
  if(!u || u.role!=='student'){
    return location.href='login.html';
  }
  const whoEl = document.getElementById('who');
  if(whoEl) whoEl.textContent = u.name || u.id || 'Estudiante';

  // Recursos de BiologÃ­a 1M
  try{
    const course = await fetch('../data/courses.json')
      .then(r=>r.json())
      .then(j=>j["BiologÃ­a 1M"]);
    const ctn = document.getElementById('res');
    if(course && ctn && Array.isArray(course.resources)){
      course.resources.forEach(r=>{
        const a = document.createElement('a');
        a.className = 'btn';
        a.href = r.href;
        a.textContent = r.label;
        ctn.appendChild(a);
      });
    }
  }catch(e){
    console.warn('No se pudieron cargar recursos de BiologÃ­a 1M', e);
  }

  // Avance del estudiante (stats_by_student desde Sheets)
  try{
    if(window.PEVE_ADMIN && typeof PEVE_ADMIN.peveStatsByStudent === 'function'){
      const res = await PEVE_ADMIN.peveStatsByStudent(u.id);
      if(res && res.status === 'ok' && Array.isArray(res.rows) && res.rows.length){
        const main = document.querySelector('main');
        if(main){
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>ğŸ“Š Mi avance en ğŸ“šPEVE</h3>
            <p>Resumen de tus intentos registrados en los quizzes.</p>
            <table class="table">
              <thead>
                <tr>
                  <th>Curso</th>
                  <th>OA</th>
                  <th>Intentos</th>
                  <th>Promedio</th>
                </tr>
              </thead>
              <tbody id="stats-student-self"></tbody>
            </table>
          `;
          main.appendChild(card);
          const tb = card.querySelector('#stats-student-self');
          res.rows.forEach(x=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${x.courseId}</td><td>${x.oa}</td><td>${x.intentos}</td><td>${x.promedio}</td>`;
            tb.appendChild(tr);
          });
        }
      }
    }
  }catch(err){
    console.warn('No se pudo cargar stats_by_student para estudiante', err);
  }
});
</script>

<script defer src="../assets/api.js"></script>
<meta name="theme-color" content="#0b0f14">
</head>
<body data-home="../index.html">

<header class="header">
  <div class="logo">
    <span class="badge">ğŸ“šPEVE</span>
    <span class="title">Plataforma ExÃ¡menes de ValidaciÃ³n de Estudios</span>
  </div>
  <div class="row">
    <button class="toggle" data-action="fs-dec">Aâˆ’</button>
    <button class="toggle" data-action="fs-inc">A+</button>
    <button class="toggle" data-action="contrast">ğŸŒ“ Alto contraste</button>
  </div>
</header>

<main>
  <div class="row" style="justify-content:space-between;align-items:center">
    <h2>ğŸ‘©â€ğŸ“ Estudiante â€” <span id="who"></span></h2>
    <button class="toggle" data-action="logout">Cerrar sesiÃ³n</button>
  </div>
  <div class="card">
    <h3>BiologÃ­a 1Â° Medio â€” Recursos</h3>
    <div id="res" class="row"></div>
  </div>
</main>

<footer class="footer">
  <div>ğŸ“šPEVE - Plataforma ExÃ¡menes de ValidaciÃ³n de Estudios</div>
  <div>ğŸ“šNEOTECH EDULAB SpA. - Todos los derechos reservados - Prohibida su copia y/o reproduccion</div>
  <div>ğŸ› ï¸Creado por:</div>
  <div>ğŸ‘©â€ğŸ«BelÃ©n AcuÃ±a PÃ©rez â€” ğŸ“§ belen.acpe@gmail.com Â· ğŸ“ +56 9 6266 4960</div>
  <div>ğŸ‘¨â€ğŸ’»Francisco Pinto â€” ğŸ“§ franciscoandresp@gmail.com Â· ğŸ“ +56 9 2002 7992</div>
  <div>Hecho con â¤ï¸ para el Liceo Bicentenario de Excelencia Polivalente San NicolÃ¡s</div>
 </footer>
  
</body></html>
