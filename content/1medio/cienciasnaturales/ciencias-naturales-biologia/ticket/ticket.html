
<!doctype html>
<html lang="es">
<head>
  <meta name="theme-color" content="#0c0f10">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ğŸŸï¸ Ticket de salida â€” OA2</title>
  <link rel="stylesheet" href="../style.css">
  <script defer src="../../../../../assets/app.js"></script>
  <script defer src="../../../../../assets/api.js"></script>
</head>
<body>
  <nav class="controls">
    <span class="control-title">ğŸ› ï¸ Controles:</span>
    <a class="control-btn" href="../index.html">ğŸ </a>
    <button class="control-btn" onclick="handleSpeak()">ğŸ—£ï¸</button>
    <div class="theme-switcher">
  <button id="themeBtn" class="control-btn" title="Temas (Alt+T)" aria-label="Cambiar tema" onclick="toggleThemeMenu()">ğŸŒ“</button>
  <div id="themeMenu" class="theme-menu hidden" role="menu" aria-label="Selector de tema">
    <button onclick="setTheme('light')" role="menuitem">â˜€ï¸ Claro</button>
    <button onclick="setTheme('dark')" role="menuitem">ğŸŒ™ Oscuro</button>
    <button onclick="setTheme('high')" role="menuitem">âš¡ Alto contraste</button>
    <button onclick="setTheme('sepia')" role="menuitem">ğŸ“œ Sepia</button>
  </div>
</div>
    <button class="control-btn" onclick="fontDelta(1)">A+</button>
    <button class="control-btn" onclick="fontDelta(-1)">Aâˆ’</button>
    <button class="control-btn" onclick="toggleLang(this)">ğŸŒ</button>
    <button class="control-btn" onclick="toggleGuide(true)">ğŸ§ </button>
    <button class="control-btn" onclick="toggleRuler(this)">ğŸ”</button>
    <span class="spacer"></span>
    <button class="control-btn" onclick="handleStop()">â¹</button>
  </nav>

  <main class="section" id="intro">
    <h1>ğŸŸï¸ Ticket de salida â€” OA2</h1>
    <div class="card">
      <ol>
        <li>Escribe una evidencia que <strong>apoye</strong> la evoluciÃ³n y explica por quÃ©.</li>
        <li>En la simulaciÃ³n, Â¿quÃ© variable te ayudÃ³ a entender la selecciÃ³n natural?</li>
        <li>Una idea de Darwin/Wallace que te parezca clave (y por quÃ©).</li>
      </ol>
      <p><em>Tip:</em> puedes copiar tus respuestas y pegarlas en Google Classroom o imprimir esta pÃ¡gina.</p>
      <div class="ticket-form">
        <h2>âœï¸ Escribe tus respuestas</h2>
        <label>
          1) Evidencia que apoya la evoluciÃ³n
          <textarea id="t_learned" rows="3" placeholder="Escribe aquÃ­ tu respuesta..."></textarea>
        </label>
        <label>
          2) Variable de la simulaciÃ³n que te ayudÃ³ a entender la selecciÃ³n natural
          <textarea id="t_doubt" rows="3" placeholder="Escribe aquÃ­ tu respuesta..."></textarea>
        </label>
        <label>
          3) Idea clave de Darwin/Wallace
          <textarea id="t_example" rows="3" placeholder="Escribe aquÃ­ tu respuesta..."></textarea>
        </label>
        <p class="note">
          Si estÃ¡s trabajando con ğŸ“šPEVE y has iniciado sesiÃ³n como estudiante, puedes guardar este ticket en tu registro.
        </p>
      </div>

    </div>
    <div class="btn-row" style="margin-top:1rem">
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Imprimir / Guardar PDF</button>
      <a class="btn" href="../index.html">â¬…ï¸ Volver</a>
      <button class="btn" onclick="saveTicket()">ğŸ’¾ Guardar en PEVE</button>
    </div>
  </main>

  <div class="modal" id="guideModal"><div class="box"><span class="close" onclick="toggleGuide(false)">âœ–</span><h3>ğŸ§  GuÃ­a</h3><p>Responde con frases breves y ejemplos concretos.</p></div></div>
  <div id="ruler" class="ruler"></div>
  <script src="../js/script.js"></script>

  <script>
    async function saveTicket(){
      const learned = document.getElementById('t_learned')?.value.trim() || '';
      const doubt   = document.getElementById('t_doubt')?.value.trim() || '';
      const example = document.getElementById('t_example')?.value.trim() || '';
      if(!learned && !doubt && !example){
        alert('Escribe al menos una respuesta antes de guardar el ticket.');
        return;
      }
      try{
        const u = (typeof getSession === 'function') ? getSession() : null;
        if(!u || !u.id){
          alert('Para guardar el ticket en PEVE, primero ingresa por el panel de Estudiante.');
          return;
        }
        if(!window.PEVE_API || typeof PEVE_API.pevePost !== 'function'){
          alert('La API de PEVE no estÃ¡ configurada (revisa data/config.json y assets/api.js).');
          return;
        }
        await PEVE_API.pevePost('ticket_submit', {
          timestamp: new Date().toISOString(),
          userId: u.id,
          userName: u.name || '',
          course: 'BiologÃ­a 1M',
          module: 'OA2',
          learned,
          doubt,
          example
        });
        alert('Ticket guardado en tu registro PEVE (Google Sheets).');
      }catch(err){
        console.warn('No se pudo enviar el ticket a Sheets (ticket_submit).', err);
        alert('OcurriÃ³ un problema al enviar el ticket. IntÃ©ntalo mÃ¡s tarde.');
      }
    }
  </script>
</body>
</html>
