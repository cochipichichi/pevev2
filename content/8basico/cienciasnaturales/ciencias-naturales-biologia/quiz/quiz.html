<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ§ª Quiz BiologÃ­a PEVE â€” 8Â° BÃ¡sico (OA2)</title>
  <link rel="stylesheet" href="../../../../../assets/css/style.css" />
  <link rel="stylesheet" href="../../../../../assets/css/peve-cards.css" />
  <link rel="icon" type="image/svg+xml" href="../../../../../assets/logo.svg" />
  <script src="../../../../../assets/js/accessibility.js" defer></script>
  <script src="../../../../../assets/js/config.js" defer></script>
  <script src="../../../../../assets/js/peve-backend.js" defer></script>
</head>
<body class="theme-dark">
  <header class="topbar">
    <div class="topbar-left">
      <div class="logo-circle" aria-hidden="true">ğŸ§¬</div>
      <div class="brand-text">
        <span class="brand-name">PEVE</span>
        <span class="brand-subtitle">
          Plataforma de ExÃ¡menes de ValidaciÃ³n de Estudios
        </span>
      </div>
    </div>
    <nav class="topbar-nav" aria-label="NavegaciÃ³n principal">
      <a href="../../../../../index.html" class="nav-link" data-i18n="nav.inicio">Inicio</a>
      <a href="../../../../../pages/info.html" class="nav-link" data-i18n="nav.proceso">Proceso</a>
      <a href="../../../../../pages/niveles.html" class="nav-link" data-i18n="nav.niveles">Niveles</a>
      <a href="../../../../../pages/asignaturas.html" class="nav-link" data-i18n="nav.asignaturas">Asignaturas</a>
      <a href="../../../../../pages/perfiles.html" class="nav-link" data-i18n="nav.perfiles">Perfiles</a>
      <a href="../../../../../pages/accesibilidad.html" class="nav-link" data-i18n="nav.accesibilidad">Accesibilidad</a>
      <a href="../../../../../pages/acerca.html" class="nav-link" data-i18n="nav.acerca">Acerca de</a>
    </nav>

    <div class="accessibility-toolbar" aria-label="Controles de accesibilidad">
      <button class="access-btn" data-action="home" data-home="../../../../../index.html" title="Ir al inicio">ğŸ </button>
      <button class="access-btn" data-action="narrator" title="Leer el contenido de la pÃ¡gina">ğŸ—£ï¸</button>
      <button class="access-btn" data-action="toggle-theme" title="Cambiar tema claro/oscuro">ğŸŒ“</button>
      <button class="access-btn" data-action="font-inc" title="Aumentar tamaÃ±o de letra">A+</button>
      <button class="access-btn" data-action="font-dec" title="Disminuir tamaÃ±o de letra">Aâˆ’</button>
      <button class="access-btn" data-action="lang" title="Cambiar idioma ES/EN/FR">ğŸŒ</button>
      <button class="access-btn" data-action="guide" title="Mostrar guÃ­a paso a paso">ğŸ§ </button>
      <button class="access-btn" data-action="search" title="Buscar en esta pÃ¡gina">ğŸ”</button>
    </div>
  </header>

  <main id="main-content" class="page-main">
    <section class="section">
      <header class="section-header">
        <h1>ğŸ§ª Quiz de prÃ¡ctica â€“ BiologÃ­a 8Â° bÃ¡sico (OA2)</h1>
        <p>
          Responde estas preguntas de opciÃ³n mÃºltiple sobre
          <strong>estructura y funciÃ³n de la cÃ©lula</strong> (OA2). Al final podrÃ¡s
          ver tu puntaje y quÃ© Ã­tems necesitas revisar.
        </p>
      </header>

      <form id="quiz-form" class="quiz-form">
        <div class="quiz-meta">
          <div class="field-group">
            <label for="student-name">Nombre estudiante (opcional)</label>
            <input
              id="student-name"
              name="studentName"
              type="text"
              placeholder="Se completarÃ¡ automÃ¡ticamente si vienes del login"
            />
          </div>
          <div class="field-group">
            <label for="student-course">Curso / Nivel</label>
            <input
              id="student-course"
              name="studentCourse"
              type="text"
              value="8Â° BÃ¡sico"
            />
          </div>
        </div>

        <div id="quiz-items" class="quiz-items">
          <!-- Preguntas via JS -->
        </div>

        <div class="quiz-actions">
          <button type="submit" class="btn btn-solid">âœ… Enviar respuestas</button>
          <button type="button" class="btn btn-outline" id="reset-quiz">
            â™» Limpiar intento
          </button>
        </div>
      </form>

      <section id="quiz-results" class="quiz-results" hidden>
        <h2>Resultados</h2>
        <p id="score-text"></p>
        <table class="results-table">
          <thead>
            <tr>
              <th>#</th>
              <th>OA / Tema</th>
              <th>Tu respuesta</th>
              <th>Correcta</th>
            </tr>
          </thead>
          <tbody id="results-body"></tbody>
        </table>
      </section>
    </section>
  </main>

  <footer class="footer small">
    <div class="footer-inner">
      <div class="footer-bar">
        <div class="logo">
          <img
            src="../../../../../assets/logo.svg"
            alt="Neotech EduLab"
            class="logo-img"
            onerror="this.style.display='none'"
          />
          <div><strong>Â© <strong>Neotech EduLab</strong>-EducaciÃ³n Inmersiva</div>
          <small>ğŸ› ï¸Prohibida su copia y/o reproducciÃ³n</small>
        </div>
      </div>
      <div class="footer-text">
        <p>
          Â© 2025 <strong>ğŸ“šPEVE</strong> â€“ Plataforma de ExÃ¡menes de ValidaciÃ³n de
          Estudios Â· Hecho con â¤ï¸ y enfoque inclusivo.
        </p>
        <p class="footer-note">
          PEVE es un recurso pedagÃ³gico complementario. La inscripciÃ³n, rendiciÃ³n y
          certificaciÃ³n de ExÃ¡menes Libres depende exclusivamente del Ministerio de
          EducaciÃ³n de Chile y sus canales oficiales.
        </p>
      </div>
    </div>
  </footer>

  <script>
    const QUESTIONS = [
      {
        id: 1,
        oa: "OA2 â€“ CÃ©lula como unidad bÃ¡sica",
        prompt:
          "Â¿Por quÃ© se dice que la cÃ©lula es la unidad bÃ¡sica de los seres vivos?",
        options: [
          "Porque todas las cÃ©lulas son visibles a simple vista.",
          "Porque todas las funciones vitales ocurren en las cÃ©lulas.",
          "Porque solo las plantas tienen cÃ©lulas.",
          "Porque las cÃ©lulas solo sirven para reproducirse."
        ],
        answer: 1
      },
      {
        id: 2,
        oa: "OA2 â€“ OrgÃ¡nulos celulares",
        prompt:
          "Â¿QuÃ© orgÃ¡nulo se asocia principalmente con la producciÃ³n de energÃ­a (ATP) en la cÃ©lula?",
        options: [
          "Cloroplasto",
          "NÃºcleo",
          "Mitocondria",
          "Ribosoma"
        ],
        answer: 2
      },
      {
        id: 3,
        oa: "OA2 â€“ CÃ©lula vegetal vs animal",
        prompt:
          "Â¿CuÃ¡l de las siguientes estructuras estÃ¡ presente solo en las cÃ©lulas vegetales?",
        options: [
          "Membrana plasmÃ¡tica",
          "Pared celular",
          "Mitocondria",
          "NÃºcleo"
        ],
        answer: 1
      },
      {
        id: 4,
        oa: "OA2 â€“ Membrana plasmÃ¡tica",
        prompt:
          "La membrana plasmÃ¡tica se caracteriza por ser semipermeable. Esto significa que:",
        options: [
          "Deja pasar todas las sustancias sin control.",
          "No deja pasar ninguna sustancia.",
          "Permite el paso de algunas sustancias y regula su entrada y salida.",
          "Solo deja pasar sustancias sÃ³lidas."
        ],
        answer: 2
      },
      {
        id: 5,
        oa: "OA2 â€“ Niveles de organizaciÃ³n",
        prompt:
          "El orden correcto desde lo mÃ¡s pequeÃ±o a lo mÃ¡s complejo es:",
        options: [
          "Tejido â†’ CÃ©lula â†’ Ã“rgano â†’ Sistema",
          "CÃ©lula â†’ Tejido â†’ Ã“rgano â†’ Sistema",
          "Ã“rgano â†’ Sistema â†’ CÃ©lula â†’ Tejido",
          "Sistema â†’ Ã“rgano â†’ Tejido â†’ CÃ©lula"
        ],
        answer: 1
      }
    ];

    const quizContainer = document.getElementById("quiz-items");
    const form = document.getElementById("quiz-form");
    const resultsSection = document.getElementById("quiz-results");
    const resultsBody = document.getElementById("results-body");
    const scoreText = document.getElementById("score-text");
    const resetBtn = document.getElementById("reset-quiz");

    function getStudentContext() {
      const nameFromSession = sessionStorage.getItem("studentName") || "";
      const levelFromSession = sessionStorage.getItem("studentLevel") || "8Â° BÃ¡sico";
      return {
        name: nameFromSession,
        level: levelFromSession
      };
    }

    function renderQuiz() {
      const ctx = getStudentContext();
      const nameInput = document.getElementById("student-name");
      const courseInput = document.getElementById("student-course");
      if (ctx.name && nameInput && !nameInput.value) nameInput.value = ctx.name;
      if (ctx.level && courseInput && !courseInput.value) courseInput.value = ctx.level;

      quizContainer.innerHTML = "";
      QUESTIONS.forEach((q, idx) => {
        const block = document.createElement("article");
        block.className = "quiz-item";
        block.innerHTML = `
          <h3>Pregunta ${idx + 1} <small>(${q.oa})</small></h3>
          <p>${q.prompt}</p>
          <div class="quiz-options">
            ${q.options
              .map(
                (opt, i) => `
              <label class="quiz-option">
                <input type="radio" name="q${q.id}" value="${i}" required />
                <span>${opt}</span>
              </label>
            `
              )
              .join("")}
          </div>
        `;
        quizContainer.appendChild(block);
      });
    }

    form.addEventListener("submit", (ev) => {
      ev.preventDefault();
      const formData = new FormData(form);
      const ctx = getStudentContext();

      const nameInput = document.getElementById("student-name");
      const courseInput = document.getElementById("student-course");
      const name =
        (nameInput && nameInput.value.trim()) || ctx.name || "Estudiante PEVE";
      const course =
        (courseInput && courseInput.value.trim()) || ctx.level || "8Â° BÃ¡sico";

      let correct = 0;
      resultsBody.innerHTML = "";

      QUESTIONS.forEach((q, idx) => {
        const userAnswerStr = formData.get(`q${q.id}`);
        const userAnswer = userAnswerStr !== null ? parseInt(userAnswerStr, 10) : -1;
        const isCorrect = userAnswer === q.answer;
        if (isCorrect) correct++;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${idx + 1}</td>
          <td>${q.oa}</td>
          <td>${userAnswer >= 0 ? q.options[userAnswer] : "Sin respuesta"}</td>
          <td>${q.options[q.answer]}</td>
        `;
        if (!isCorrect) row.classList.add("row-incorrect");
        resultsBody.appendChild(row);
      });

      const scorePercent = Math.round((correct / QUESTIONS.length) * 100);
      scoreText.textContent = `Obtuviste ${correct} de ${
        QUESTIONS.length
      } respuestas correctas (${scorePercent}%).`;
      resultsSection.hidden = false;

      const payload = {
        name,
        course,
        score: correct,
        max: QUESTIONS.length,
        scorePercent,
        ts: new Date().toISOString()
      };

      try {
        const key = "peve_biologia8_oa2_quiz";
        const prev = JSON.parse(localStorage.getItem(key) || "[]");
        prev.push(payload);
        localStorage.setItem(key, JSON.stringify(prev));
      } catch (err) {
        console.warn("No se pudo guardar en localStorage", err);
      }

      if (window.PEVE_BACKEND) {
        window.PEVE_BACKEND
          .sendQuizResult({
            userName: name,
            course: course,
            module: "Ciencias Naturales 8Â° â€“ BiologÃ­a OA2",
            score: correct,
            max: QUESTIONS.length,
            q1: "BiologÃ­a 8Â°",
            q2: "OA2 â€“ Estructura y funciÃ³n celular"
          })
          .then((res) => {
            if (res && res.status === "ok") {
              console.log("[PEVE] Quiz BiologÃ­a OA2 enviado a Sheets");
            } else {
              console.warn(
                "[PEVE] No se pudo enviar quiz BiologÃ­a OA2 a Sheets",
                res
              );
            }
          })
          .catch((err) => {
            console.warn(
              "[PEVE] Error al enviar quiz BiologÃ­a OA2 a Sheets",
              err
            );
          });
      }
    });

    resetBtn.addEventListener("click", () => {
      form.reset();
      resultsSection.hidden = true;
    });

    renderQuiz();
  </script>
</body>
</html>
